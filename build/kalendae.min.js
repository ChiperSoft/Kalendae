(function(h){var d,e;var g=function(q,k){if(typeof document.addEventListener!=="function"&&!b.isIE8()){return}var B=false;try{B=q instanceof Element}catch(n){B=!!q&&B.nodeType===1}if(!(B||typeof(q)==="string")){k=q}var u=this,C=u.classes,t=u.settings=b.merge(u.defaults,{attachTo:q},k||{}),w=u.container=b.make("div",{"class":C.container}),m=u.calendars=[],r=e().day(t.weekStart),o,z=[],A,v,p,D,s,G=[],F,y=0,x=t.months;if(b.isIE8()){b.addClassName(w,"ie8")}y=7;while(y--){z.push(r.format(t.columnHeaderFormat));r.add("days",1)}f(u);if(typeof t.subscribe==="object"){for(y in t.subscribe){if(t.subscribe.hasOwnProperty(y)){u.subscribe(y,t.subscribe[y])}}}u._sel=[];if(!!t.selected){u.setSelected(t.selected,false)}if(!!t.viewStartDate){o=e(t.viewStartDate,t.format)}else{if(u._sel.length>0){o=e(u._sel[0])}else{o=e()}}u.viewStartDate=o.date(1);var E=({past:t.months-1,"today-past":t.months-1,any:t.months>2?Math.floor(t.months/2):0,"today-future":0,future:0})[this.settings.direction];if(E&&e().month()==e(u.viewStartDate).month()){u.viewStartDate=e(u.viewStartDate).subtract({M:E}).date(1)}if(typeof t.blackout==="function"){u.blackout=t.blackout}else{if(!!t.blackout){var l=c(t.blackout,t.parseSplitDelimiter);u.blackout=function(j){j=e(j).yearDay();if(j<1||!u._sel){return false}var H=l.length;while(H--){if(l[H].yearDay()===j){return true}}return false}}else{u.blackout=function(){return false}}}u.direction=u.directions[t.direction]?u.directions[t.direction]:u.directions.any;x=Math.max(t.months,1);while(x--){A=b.make("div",{"class":C.calendar},w);A.setAttribute("data-cal-index",x);if(t.months>1){if(x==Math.max(t.months-1,1)){b.addClassName(A,C.monthFirst)}else{if(x===0){b.addClassName(A,C.monthLast)}else{b.addClassName(A,C.monthMiddle)}}}v=b.make("div",{"class":C.title},A);if(!t.useYearNav){b.addClassName(v,C.disableYearNav)}b.make("a",{"class":C.previousYear},v);b.make("a",{"class":C.previousMonth},v);b.make("a",{"class":C.nextYear},v);b.make("a",{"class":C.nextMonth},v);p=b.make("span",{"class":C.caption},v);D=b.make("div",{"class":C.header},A);y=0;do{F=b.make("span",{},D);F.innerHTML=z[y]}while(++y<7);s=b.make("div",{"class":C.days},A);y=0;G=[];while(y++<42){G.push(b.make("span",{},s))}m.push({caption:p,days:G});if(x){b.make("div",{"class":C.monthSeparator},w)}}u.draw();b.addEvent(w,"mousedown",function(j,H){var i;if(b.hasClassName(H,C.nextMonth)){if(!u.disableNext&&u.publish("view-changed",u,["next-month"])!==false){u.viewStartDate.add("months",1);u.draw()}return false}else{if(b.hasClassName(H,C.previousMonth)){if(!u.disablePreviousMonth&&u.publish("view-changed",u,["previous-month"])!==false){u.viewStartDate.subtract("months",1);u.draw()}return false}else{if(b.hasClassName(H,C.nextYear)){if(!u.disableNext&&u.publish("view-changed",u,["next-year"])!==false){u.viewStartDate.add("years",1);u.draw()}return false}else{if(b.hasClassName(H,C.previousYear)){if(!u.disablePreviousMonth&&u.publish("view-changed",u,["previous-year"])!==false){u.viewStartDate.subtract("years",1);u.draw()}return false}else{if(b.hasClassName(H.parentNode,C.days)&&b.hasClassName(H,C.dayActive)&&(i=H.getAttribute("data-date"))){i=e(i,t.dayAttributeFormat).hours(12);if(u.publish("date-clicked",u,[i])!==false){switch(t.mode){case"multiple":if(!u.addSelected(i)){u.removeSelected(i)}break;case"range":u.addSelected(i);break;case"single":default:u.addSelected(i);break}}return false}}}}}return false});if(!!(t.attachTo=b.$(t.attachTo))){t.attachTo.appendChild(w)}};g.prototype={defaults:{attachTo:null,months:1,weekStart:0,direction:"any",directionScrolling:true,viewStartDate:null,blackout:null,selected:null,mode:"single",dayOutOfMonthClickable:false,format:null,subscribe:null,columnHeaderFormat:"dd",titleFormat:"MMMM, YYYY",dayNumberFormat:"D",dayAttributeFormat:"YYYY-MM-DD",parseSplitDelimiter:/,\s*|\s+-\s+/,rangeDelimiter:" - ",multipleDelimiter:", ",useYearNav:true,dateClassMap:{}},classes:{container:"kalendae",calendar:"k-calendar",monthFirst:"k-first-month",monthMiddle:"k-middle-month",monthLast:"k-last-month",title:"k-title",previousMonth:"k-btn-previous-month",nextMonth:"k-btn-next-month",previousYear:"k-btn-previous-year",nextYear:"k-btn-next-year",caption:"k-caption",header:"k-header",days:"k-days",dayOutOfMonth:"k-out-of-month",dayInMonth:"k-in-month",dayActive:"k-active",daySelected:"k-selected",dayInRange:"k-range",dayToday:"k-today",monthSeparator:"k-separator",disablePreviousMonth:"k-disable-previous-month-btn",disableNextMonth:"k-disable-next-month-btn",disablePreviousYear:"k-disable-previous-year-btn",disableNextYear:"k-disable-next-year-btn",disableYearNav:"k-disable-year-nav"},disablePreviousMonth:false,disableNextMonth:false,disablePreviousYear:false,disableNextYear:false,directions:{past:function(i){return e(i).yearDay()>=d.yearDay()},"today-past":function(i){return e(i).yearDay()>d.yearDay()},any:function(i){return false},"today-future":function(i){return e(i).yearDay()<d.yearDay()},future:function(i){return e(i).yearDay()<=d.yearDay()}},getSelectedAsDates:function(){var j=[];var k=0,l=this._sel.length;for(;k<l;k++){j.push(this._sel[k].toDate())}return j},getSelectedAsText:function(l){var j=[];var k=0,m=this._sel.length;for(;k<m;k++){j.push(this._sel[k].format(l||this.settings.format||"YYYY-MM-DD"))}return j},getSelectedRaw:function(){var j=[];var k=0,l=this._sel.length;for(;k<l;k++){j.push(e(this._sel[k]))}return j},getSelected:function(j){var i=this.getSelectedAsText(j);switch(this.settings.mode){case"range":i.splice(2);return i.join(this.settings.rangeDelimiter);case"multiple":return i.join(this.settings.multipleDelimiter);case"single":default:return i[0]}},isSelected:function(l){l=e(l).yearDay();if(l<1||!this._sel||this._sel.length<1){return false}switch(this.settings.mode){case"range":var k=this._sel[0]?this._sel[0].yearDay():0,j=this._sel[1]?this._sel[1].yearDay():0;if(k===l||j===l){return 1}if(!k||!j){return 0}if((l>k&&l<j)||(k<j&&l<k&&l>j)){return -1}return false;case"multiple":var m=this._sel.length;while(m--){if(this._sel[m].yearDay()===l){return true}}return false;case"single":default:return(this._sel[0]&&(this._sel[0].yearDay()===l))}return false},setSelected:function(k,j){var m,n=c(k,this.settings.parseSplitDelimiter,this.settings.format),l=c(this.getSelected(),this.settings.parseSplitDelimiter,this.settings.format);m=l.length;while(m--){this.removeSelected(l[m],j)}m=n.length;while(m--){this.addSelected(n[m],j)}if(j!==false){this.viewStartDate=e(n[0],this.settings.format).dates(1);this.draw()}},addSelected:function(j,i){j=e(j).hours(12);if(this.settings.dayOutOfMonthClickable&&this.settings.mode!=="range"){this.makeSelectedDateVisible(j)}switch(this.settings.mode){case"multiple":if(!this.isSelected(j)){this._sel.push(j)}else{return false}break;case"range":if(this._sel.length!==1){this._sel=[j]}else{if(j.yearDay()>this._sel[0].yearDay()){this._sel[1]=j}else{this._sel=[j,this._sel[0]]}}break;case"single":default:this._sel=[j];break}this._sel.sort(function(l,k){return l.yearDay()-k.yearDay()});this.publish("change",this,[j]);if(i!==false){this.draw()}return true},makeSelectedDateVisible:function(i){outOfViewMonth=e(i).date("1").diff(this.viewStartDate,"months");if(outOfViewMonth<0){this.viewStartDate.subtract("months",1)}else{if(outOfViewMonth>0&&outOfViewMonth>=this.settings.months){this.viewStartDate.add("months",1)}}},removeSelected:function(k,j){k=e(k).hours(12);var l=this._sel.length;while(l--){if(this._sel[l].yearDay()===k.yearDay()){this._sel.splice(l,1);this.publish("change",this,[k]);if(j!==false){this.draw()}return true}}return false},draw:function a(){var r=e(this.viewStartDate).hours(12),w,n=this.classes,m,v,t,q=0,u,p=0,o,z,x,l=this.settings,y;u=this.calendars.length;do{w=e(r).date(1);w.day(w.day()<this.settings.weekStart?this.settings.weekStart-7:this.settings.weekStart);m=this.calendars[q];m.caption.innerHTML=r.format(this.settings.titleFormat);p=0;do{v=m.days[p];t=[];z=this.isSelected(w);if(z){t.push(({"-1":n.dayInRange,"1":n.daySelected,"true":n.daySelected})[z])}if(w.month()!=r.month()){t.push(n.dayOutOfMonth)}else{t.push(n.dayInMonth)}if(!(this.blackout(w)||this.direction(w)||(w.month()!=r.month()&&l.dayOutOfMonthClickable===false))||z>0){t.push(n.dayActive)}if(w.yearDay()===d.yearDay()){t.push(n.dayToday)}x=w.format(this.settings.dayAttributeFormat);if(l.dateClassMap[x]){t.push(l.dateClassMap[x])}v.innerHTML=w.format(l.dayNumberFormat);v.className=t.join(" ");v.setAttribute("data-date",x);w.add("days",1)}while(++p<42);r.add("months",1)}while(++q<u);if(l.directionScrolling){if(l.direction==="today-past"||l.direction==="past"){y=r.add({m:1}).diff(e(),"months",true);if(y<=0){this.disableNextMonth=false;b.removeClassName(this.container,n.disableNextMonth)}else{this.disableNextMonth=true;b.addClassName(this.container,n.disableNextMonth)}}else{if(l.direction==="today-future"||l.direction==="future"){y=r.subtract({m:1}).diff(e(),"months",true);if(y>l.months){this.disablePreviousMonth=false;b.removeClassName(this.container,n.disablePreviousMonth)}else{this.disablePreviousMonth=true;b.addClassName(this.container,n.disablePreviousMonth)}}}if(l.direction==="today-past"||l.direction==="past"){y=r.add({m:12}).diff(e(),"months",true);if(y<=-11){this.disableNextYear=false;b.removeClassName(this.container,n.disableNextYear)}else{this.disableNextYear=true;b.addClassName(this.container,n.disableNextYear)}}else{if(l.direction==="today-future"||l.direction==="future"){y=r.subtract({m:12}).diff(e(),"months",true);if(y>(11+l.months)){this.disablePreviousYear=false;b.removeClassName(this.container,n.disablePreviousYear)}else{this.disablePreviousYear=true;b.addClassName(this.container,n.disablePreviousYear)}}}}}};var c=function(l,k,n){var j=[];if(typeof l==="string"){l=l.split(k)}else{if(!b.isArray(l)){l=[l]}}var o=l.length,m=0;do{if(l[m]){j.push(e(l[m],n).hours(12))}}while(++m<o);return j};window.Kalendae=g;var b=g.util={isIE8:function(){return !!((/msie 8./i).test(navigator.appVersion)&&!(/opera/i).test(navigator.userAgent)&&window.ActiveXObject&&XDomainRequest&&!window.msPerformance)},$:function(i){return(typeof i=="string")?document.getElementById(i):i},$$:function(i){return document.querySelectorAll(i)},make:function(m,l,j){var i,n=document.createElement(m);if(!!l){for(i in l){if(l.hasOwnProperty(i)){n.setAttribute(i,l[i])}}}if(!!j){j.appendChild(n)}return n},isVisible:function(i){return i.offsetWidth>0||i.offsetHeight>0},getStyle:function(j,i){var k;if(j.currentStyle){k=j.currentStyle[i]}else{if(window.getComputedStyle){k=window.getComputedStyle(j,null)[i]}}return k},domReady:function(i){/in/.test(document.readyState)?setTimeout(function(){b.domReady(i)},9):i()},addEvent:function(j,i,l){var k=function(m){m=m||window.event;var n=m.target||m.srcElement;var o=l.apply(j,[m,n]);if(o===false){if(!!m.preventDefault){m.preventDefault()}else{m.returnValue=false;m.cancelBubble=true}}return o};if(j.attachEvent){j.attachEvent("on"+i,k)}else{j.addEventListener(i,k,false)}return k},removeEvent:function(j,i,k){if(j.detachEvent){j.detachEvent("on"+i,k)}else{j.removeEventListener(i,k,false)}},hasClassName:function(k,j){if(!(k=b.$(k))){return false}var i=k.className;return(i.length>0&&(i==j||new RegExp("(^|\\s)"+j+"(\\s|$)").test(i)))},addClassName:function(j,i){if(!(j=b.$(j))){return}if(!b.hasClassName(j,i)){j.className+=(j.className?" ":"")+i}},removeClassName:function(j,i){if(!(j=b.$(j))){return}j.className=b.trimString(j.className.replace(new RegExp("(^|\\s+)"+i+"(\\s+|$)")," "))},isFixed:function(i){do{if(b.getStyle(i,"position")==="fixed"){return true}}while((i=i.offsetParent));return false},scrollContainer:function(i){do{var j=b.getStyle(i,"overflow");if(j==="auto"||j==="scroll"){return i}}while((i=i.parentNode)&&i!=window.document.body);return null},getPosition:function(l,j){var i=l.offsetLeft,m=l.offsetTop,k={};if(!j){while((l=l.offsetParent)){i+=l.offsetLeft;m+=l.offsetTop}}k[0]=k.left=i;k[1]=k.top=m;return k},getHeight:function(i){return i.offsetHeight||i.scrollHeight},getWidth:function(i){return i.offsetWidth||i.scrollWidth},trimString:function(i){return i.replace(/^\s+/,"").replace(/\s+$/,"")},merge:function(){var j=(arguments[0]===true),m={},l=j?1:0;var k=function(n,i){if(typeof i!=="object"){return}for(var o in i){if(i.hasOwnProperty(o)){if(j&&typeof n[o]==="object"&&typeof i[o]==="object"){_update(n[o],i[o])}else{n[o]=i[o]}}}return n};for(;l<arguments.length;l++){k(m,arguments[l])}return m},isArray:function(i){return Object.prototype.toString.call(i)=="[object Array]"}};if(typeof document.addEventListener==="function"){g.util.domReady(function(){var l=b.$$(".auto-kal"),k=l.length,m,j,n;while(k--){m=l[k];n=m.getAttribute("data-kal");j=(n==null||n=="")?{}:(new Function("return {"+n+"};"))();if(m.tagName==="INPUT"){new g.Input(m,j)}else{new g(b.merge(j,{attachTo:m}))}}})}g.Input=function(n,s){if(typeof document.addEventListener!=="function"&&!b.isIE8()){return}var o=this.input=b.$(n),p,k;if(!o||o.tagName!=="INPUT"){throw"First argument for Kalendae.Input must be an <input> element or a valid element id."}var r=this,l=r.classes,i=r.settings=b.merge(r.defaults,s);i.attachTo=window.document.body;if(!i.selected){i.selected=o.value}else{p=true}g.call(r,i);if(i.closeButton){k=b.make("a",{"class":l.closeButton},r.container);b.addEvent(k,"click",function(){o.blur()})}if(p){o.value=r.getSelected()}var q=r.container,m=false;q.style.display="none";b.addClassName(q,l.positioned);b.addEvent(q,"mousedown",function(t,u){m=true});b.addEvent(window.document,"mousedown",function(t,u){m=false});b.addEvent(o,"focus",function(){r.setSelected(this.value);r.show()});b.addEvent(o,"blur",function(){if(m){m=false;o.focus()}else{r.hide()}});b.addEvent(o,"keyup",function(t){r.setSelected(this.value)});var j=b.scrollContainer(o);if(j){b.addEvent(j,"scroll",function(t){o.blur()})}r.subscribe("change",function(){o.value=r.getSelected()})};g.Input.prototype=b.merge(g.prototype,{defaults:b.merge(g.prototype.defaults,{format:"MM/DD/YYYY",side:"bottom",closeButton:true,offsetLeft:0,offsetTop:0}),classes:b.merge(g.prototype.classes,{positioned:"k-floating",closeButton:"k-btn-close"}),show:function(){var m=this.container,j=m.style,o=this.input,n=b.getPosition(o),i=b.scrollContainer(o),l=i?i.scrollTop:0,k=this.settings;j.display="";switch(k.side){case"left":j.left=(n.left-b.getWidth(m)+k.offsetLeft)+"px";j.top=(n.top+k.offsetTop-l)+"px";break;case"right":j.left=(n.left+b.getWidth(o))+"px";j.top=(n.top+k.offsetTop-l)+"px";break;case"top":j.left=(n.left+k.offsetLeft)+"px";j.top=(n.top-b.getHeight(m)+k.offsetTop-l)+"px";break;case"bottom":default:j.left=(n.left+k.offsetLeft)+"px";j.top=(n.top+b.getHeight(o)+k.offsetTop-l)+"px";break}j.position=b.isFixed(o)?"fixed":"absolute";this.publish("show",this)},hide:function(){this.container.style.display="none";this.publish("hide",this)}});
/*
* MinPubSub, modified for use on Kalendae
* Copyright(c) 2011 Daniel Lamb <daniellmb.com>
* https://github.com/daniellmb/MinPubSub
* MIT Licensed
*/
var f=function(j){if(!j){j=this}var i=j.c_||{};j.publish=function(m,p,l){var n=i[m],k=n?n.length:0,o;while(k--){o=n[k].apply(p,l||[]);if(typeof o==="boolean"){return o}}};j.subscribe=function(k,m,l){if(!i[k]){i[k]=[]}if(l){i[k].push(m)}else{i[k].unshift(m)}return[k,m]};j.unsubscribe=function(m){var l=i[m[0]],n=m[1],k=l?l.length:0;while(k--){if(l[k]===n){l.splice(k,1)}}}};if(!g.moment){if(window.moment){g.moment=window.moment}else{throw"Kalendae requires moment.js. You must use kalendae.standalone.js if moment is not available on the page."}}e=g.moment;e.fn.stripTime=function(){this._d=new Date(Math.floor(this._d.valueOf()/86400000)*86400000);return this};e.fn.yearDay=function(j){var i=Math.floor(this._d/86400000);return(typeof j==="undefined")?i:this.add({d:j-i})};d=g.moment().stripTime();if(typeof jQuery!=="undefined"&&typeof document.addEventListener==="function"){jQuery.fn.kalendae=function(i){this.each(function(j,k){if(k.tagName==="INPUT"){$(k).data("kalendae",new g.Input(k,i))}else{$(k).data("kalendae",new g($.extend({},{attachTo:k},i)))}});return this}}})();